<div class="app"></div>
<button class="btn-start">Start/stop</button>
<button class="btn-clear">Clear</button>
<button class="btn-random">Random</button>

<script>
  const size = 20;
  const container = document.querySelector('.app');
  const startBtn = document.querySelector('.btn-start');
  const clearBtn = document.querySelector('.btn-clear');
  const randomBtn = document.querySelector('.btn-random');
  let field = [];
  let isRunning = false;
  clear();
  render();

  startBtn.addEventListener('click', () => {
    isRunning = !isRunning;
  })
  randomBtn.addEventListener('click', () => {
    field = [...new Array(size*size)].map(() => Math.round(Math.random()));
    render();
  })
  clearBtn.addEventListener('click', () => {
    clear();
    render();
  })
  container.addEventListener('click', event => {
    if (event.target.classList.contains('cell')) {
      const index = event.target.dataset.index;

      console.log(getIndexNeigbours(index))

      field[index] = Number(!field[index]);
      render();
    }
  })

  function clear() {
    field = [...new Array(size*size)].map(() => 0)
  }

  setTimeout(tick, 100);

  function tick() {
    if (isRunning) {
      const newField = [];
      for (let i = 0; i < size*size; i++) {
        newField[i] = getNewValue(i, field[i]);
      }
      field = newField;
      render();
    }

    setTimeout(tick, 100);
  }

  function  getNewValue(index, value) {
    const neighboursCount = getAliveNeighbours(index%size, Math.floor(index/size));
    if (value === 0 && neighboursCount === 3) {
      return 1;
    }
    if (value === 1) {
      if (neighboursCount === 2 || neighboursCount === 3) {
        return 1;
      }
    }
    return 0;
  }

  function getIndexNeigbours (index) {
    return getNeighbours(index % size, Math.floor(index/size))
  }

  function getNeighbours (x, y) {
    return [
      getCell(x-1,y-1),
      getCell(x,y-1),
      getCell(x+1,y-1),
      getCell(x-1,y),
      getCell(x+1,y),
      getCell(x-1,y+1),
      getCell(x,y+1),
      getCell(x+1,y+1),
    ];
  }

  function getAliveNeighbours (x, y) {
    return getNeighbours(x,y).filter(x => Boolean(x)).length;
  }

  function getCell (x = 0, y = 0) {
    if (x < 0) {
      x = size + x;
    }
    if (y < 0) {
      y = size + y;
    }
    x = Math.abs(x % size);
    y = Math.abs(y % size);
    return field[x + y*size];
  }

  function render () {
    container.style = `width: ${size * 40}px;`;
    container.innerHTML = field.map((value,index)=>
      `<div class="cell ${value ? 'alive':''}" title="${index%size},${Math.floor(index/size)}" data-index="${index}"></div>`).join('');
  }
</script>

<style>
    .app {
        display: flex;
        flex-wrap: wrap;
        border: 2px grey dotted;
    }
    .cell{
        width: 40px;
        height: 40px;
        border: 2px solid white;
        box-sizing: border-box;
        border-radius: 50%;
    }
    .cell:hover {
        border-color: rgb(34, 150, 245);
    }
    .alive {
        background-color: darkgrey;
    }
</style>